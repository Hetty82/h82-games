<section class="container active-game">
  <header class="header">
    <h1 class="title">Friday Game {{ activeGameId }} - round {{ currentRound$ | async }} - difficulty {{ difficulty }}</h1>

    <span *ngIf="loading$ | async" class="loader">Loading...</span>

    <ng-container *ngIf="!loading && !playing" class="buttons">
      <button *ngIf="!currentRound$ | async" (click)="start()" class="button">Start game #{{ activeGameId }}</button>
      <button *ngIf="currentRound$ | async" (click)="continue()" class="button">Continue game #{{ activeGameId }}</button>
    </ng-container>

    <a routerLink="/friday" class="link">Exit and save</a>
  </header>

  <pre class="dev">
    available actions: {{ availableActions | json }}
  </pre>

  <section *ngIf="playing$ | async" class="table">
    <section class="game-section round">
      Round: {{ currentRound$ | async }}
    </section>

    <section class="game-section lives">
      Lives: {{ lives$ | async }}
    </section>

    <section class="game-section destroyed">
      <div class="pile">
        Destroyed:
        <div class="cards">
          {{ (destroyed$ | async).length }}
        </div>
      </div>
    </section>

    <section class="game-section hazard">
      <div class="pile">
        Hazard Cards:
        <div class="cards">
          {{ (hazards$ | async).length }}
        </div>

        <button (click)="drawHazardCards()" class="button">
          Draw hazard cards
        </button>
      </div>

      <div class="pile">
        Discarded:
        <div class="cards">
          {{ (hazardsDiscarded$ | async).length }}
        </div>
      </div>
    </section>

    <section class="game-section robinson">
      <div class="pile">
        Robinson Cards:
        <div class="cards">
          {{ (robinsons$ | async).length }}
        </div>
      </div>

      <div class="pile">
        Discarded:
        <div class="cards">
          {{ (robinsonsDiscarded$ | async).length }}
        </div>
      </div>
    </section>

    <section class="game-section aging">
      <div class="pile">
        Aging Cards:
        <div class="cards">
          {{ (agings$ | async).length }}
        </div>
      </div>
    </section>

    <section class="game-section pirates">
      <ng-container *ngIf="(pirates$ | async) as pirateIds">
        <figure *ngFor="let id of pirateIds" class="pirate">
          <img src="assets/images/pirate-{{id}}.png">
          <figcaption class="hide">
            {{ id }}
          </figcaption>
        </figure>
      </ng-container>
    </section>

    <section class="game-section battle">
      Battle Area

      <ng-container *ngIf="(hazardEntities$ | async) as entities">
        <div *ngIf="(hazardOptions$ | async) as cardIds" class="hazard-options">
          Choose a hazard:
          <figure *ngFor="let id of cardIds" class="hazard-option">
            <img src="assets/images/battle-{{ entities[id].battleComboId }}.png">
            <figcaption>
              {{ entities[id] | json }}
              <button (click)="playHazardCard(id)" class="button">
                Play this hazard
              </button>
            </figcaption>
          </figure>
        </div>

        <p *ngIf="playedHazard$ | async as cardId">
          Played hazard: {{ playedHazard$ | async | json }}
          <figure class="played-hazard">
            <img src="assets/images/battle-{{ entities[cardId].battleComboId }}.png">
            <figcaption>
              {{ entities[cardId] | json }}
            </figcaption>
          </figure>
        </p>
      </ng-container>
      <p>
        <!-- Battle Points: {{ battle?.battlePoints| json }} -->
      </p>
      <p>
        <!-- Free Battle Cards: {{ battle?.freeBattleCards | json }} -->
      </p>
      <p>
        <!-- Payed Battle Cards: {{ battle?.payedBattleCards | json }} -->
      </p>
    </section>
  </section>
</section>
